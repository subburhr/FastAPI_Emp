<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Employee & Department Dashboard</title>
<style>
/* üåë General Styles */
body {
    background-color: #000; /* pure black background */
    color: #f0f0f0;
    font-family: "Segoe UI", Tahoma, sans-serif;
    margin: 0;
    padding: 0;
}
h1, h2 {
    color: #00e5ff;
    margin-bottom: 15px;
    text-shadow: 1px 1px 5px #000;
}
main {
    padding: 30px;
    max-width: 1600px;
    margin: auto;
}

/* üí≥ Card Layout */
.flex-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 1rem;
}
.card {
    background-color: #111;
    border: 1px solid #222;
    border-radius: 12px;
    padding: 20px;
    flex: 1;
    min-width: 46%;
    overflow-x: auto;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    transition: transform 0.2s, box-shadow 0.2s;
}
.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,255,255,0.3);
}

/* üìä Tables */
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}
th, td {
    border: 1px solid #222;
    padding: 10px 12px;
    text-align: left;
}
th {
    background: #222;
    color: #00e5ff;
}
tr:hover {
    background: #00575b;
    transition: background 0.3s;
    cursor: pointer;
}
.highlight {
    background: #00e5ff !important;
    color: #000;
}

/* üìù Forms */
form {
    background: #111;
    border: 1px solid #222;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0,255,255,0.2);
}
textarea, input {
    background: #222;
    color: #f0f0f0;
    border: 1px solid #333;
    border-radius: 6px;
    width: 100%;
    padding: 10px;
    font-family: monospace;
    resize: vertical;
    min-height: 50px;
    transition: border 0.2s, box-shadow 0.2s;
}
textarea:focus, input:focus {
    border: 1px solid #00e5ff;
    box-shadow: 0 0 8px #00e5ff;
    outline: none;
}
button {
    background-color: #222;
    color: #00e5ff;
    border: 1px solid #00e5ff;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.2s;
    margin-right: 8px;
}
button:hover {
    background-color: #00e5ff;
    color: #000;
}

/* üîπ Section Titles */
.section-title {
    border-bottom: 1px solid #00e5ff;
    padding-bottom: 5px;
    margin-bottom: 15px;
    color: #00e5ff;
}

/* üóÇ Section Cards */
.section-card {
    display: none;
    margin-top: 20px;
}
.section-card.active {
    display: block !important;
}

/* üîò Section Navigation Circles */
.section-circles,
.query-circles {
    display: flex;
    gap: 12px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}
.circle {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background-color: #222;
    color: #00e5ff;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-weight: bold;
    font-size: 16px;
    transition: 0.3s;
}
.circle.active,
.circle:hover {
    background-color: #00e5ff;
    color: #000;
    box-shadow: 0 0 8px #00e5ff;
}

/* üíæ Stored Queries */
.query-card, .result-card {
    background: #111;
    border: 1px solid #222;
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 4px 10px rgba(0,255,255,0.2);
    margin-top: 15px;
    transition: transform 0.2s, box-shadow 0.2s;
}
.query-card:hover, .result-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0,255,255,0.3);
}
.result-header {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    align-items: center;
}
.result-header code {
    background: #222;
    padding: 4px 8px;
    border-radius: 6px;
}
.success {
    color: #6f6;
    font-weight: bold;
}
.error {
    color: #f66;
    font-weight: bold;
}
.no-results {
    text-align: center;
    color: #999;
    font-style: italic;
}
a {
    color: #00e5ff;
    text-decoration: none;
}
a:hover {
    text-decoration: underline;
}

/* üì± Responsive */
@media (max-width: 900px) {
    .card {
        min-width: 100%;
    }
    .circle {
        width: 40px;
        height: 40px;
    }
}
</style>


 <script>
    // üîπ Highlight selected table rows
    function highlightRow(id) {
        document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
        document.querySelectorAll(`[data-id='${id}']`).forEach(el => el.classList.add('highlight'));
    }

    // üîπ Run stored query dynamically
    function runStoredQuery(id) {
        const queryText = document.getElementById(`query_text_${id}`)?.value;
        localStorage.setItem('activeSection', 'section-stored'); // Remember last section
        const form = document.createElement("form");
        form.method = "POST";
        form.action = "/run-query";
        const input = document.createElement("input");
        input.type = "hidden";
        input.name = "query";
        input.value = queryText;
        form.appendChild(input);
        document.body.appendChild(form);
        form.submit();
    }

    // üîπ Stored Queries Navigation
    const storedCards = [];
    const storedCircles = [];

    function initStoredQueries() {
        const cards = document.querySelectorAll('.query-card');
        const circles = document.querySelectorAll('.circle[data-id^="query-"]');

        cards.forEach(c => {
            storedCards.push(c);
            c.style.display = 'none'; // hide all initially
        });
        circles.forEach(c => storedCircles.push(c));

        if (storedCards.length > 0) showStoredCard(storedCards[0].id);

        storedCircles.forEach(circle => {
            circle.addEventListener('click', () => showStoredCard(circle.dataset.id));
        });
    }

    function showStoredCard(id) {
        storedCards.forEach(c => c.style.display = 'none');
        storedCircles.forEach(c => c.classList.remove('active'));

        const card = storedCards.find(c => c.id === id);
        if (card) card.style.display = 'block';

        const circle = storedCircles.find(c => c.dataset.id === id);
        if (circle) circle.classList.add('active');
    }

    // üîπ Section Navigation (main circles)
    const sectionCards = [];
    const sectionCircles = [];

    function initSections() {
        const cards = document.querySelectorAll('.section-card');
        const circles = document.querySelectorAll('.section-circles .circle');

        cards.forEach(c => {
            sectionCards.push(c);
            c.style.display = 'none'; // hide all initially
        });
        circles.forEach(c => sectionCircles.push(c));

        function showSection(id) {
            sectionCards.forEach(c => c.style.display = 'none');
            sectionCircles.forEach(c => c.classList.remove('active'));

            const card = sectionCards.find(c => c.id === id);
            if (card) card.style.display = 'block';

            const circle = sectionCircles.find(c => c.dataset.id === id);
            if (circle) circle.classList.add('active');

            localStorage.setItem('activeSection', id);
        }

        // Restore last opened section, if any
        const savedSection = localStorage.getItem('activeSection');
        if (savedSection && sectionCards.some(c => c.id === savedSection)) {
            showSection(savedSection);
        }

        // Add click listeners
        sectionCircles.forEach(c => {
            c.addEventListener('click', () => showSection(c.dataset.id));
        });

        // Save active section on form submit
        document.querySelectorAll("form").forEach(form => {
            form.addEventListener("submit", () => {
                const activeCard = sectionCards.find(c => c.style.display === 'block');
                if (activeCard) localStorage.setItem('activeSection', activeCard.id);
            });
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        initSections();       // main 5 sections
        initStoredQueries();  // nested stored queries
    });
</script>


</head>
<body>
<main>
    <h1>üíº Employee & Department Dashboard</h1>

    <!-- Section Navigation Circles -->
    <div class="section-circles">
        <div class="circle" data-id="section-departments">1</div>
        <div class="circle" data-id="section-employees">2</div>
        <div class="circle" data-id="section-seed">3</div>
        <div class="circle" data-id="section-query">4</div>
        <div class="circle" data-id="section-stored">5</div>
    </div>

    <!-- Departments Section -->
    <div class="section-card" id="section-departments">
        <div class="card">
            <h2>üè¢ Departments</h2>
            {% if departments %}
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Location</th>
                            <th>Budget</th>
                            <th>#Employees</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for d in departments %}
                        <tr data-id="dep-{{ d.id }}">
                            <td>{{ d.id }}</td>
                            <td>{{ d.name }}</td>
                            <td>{{ d.location }}</td>
                            <td>{{ d.budget }}</td>
                            <td>{{ d.employees|length }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No departments found.</p>
            {% endif %}
        </div>
    </div>

    <!-- Employees Section -->
    <div class="section-card" id="section-employees">
        <div class="card">
            <h2>üë®‚Äçüíº Employees</h2>
            {% if employees %}
                <table>
                    <thead>
                        <tr>
                            <th>ID</th><th>Name</th><th>Age</th><th>Email</th>
                            <th>Salary</th><th>Bonus</th><th>Hire Date</th>
                            <th>Active</th><th>Gender</th><th>Department</th><th>Manager</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for e in employees %}
                        <tr data-id="emp-{{ e.id }}">
                            <td>{{ e.id }}</td>
                            <td>{{ e.name }}</td>
                            <td>{{ e.age or '' }}</td>
                            <td>{{ e.email }}</td>
                            <td>{{ e.salary }}</td>
                            <td>{{ e.bonus }}</td>
                            <td>{{ e.hire_date }}</td>
                            <td>{{ "‚úÖ" if e.active else "‚ùå" }}</td>
                            <td>{{ e.gender }}</td>
                            <td>{{ e.department.name if e.department else '' }}</td>
                            <td>{{ e.manager.name if e.manager else '' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No employees found.</p>
            {% endif %}
        </div>
    </div>

    <!-- Seed Data Section -->
    <div class="section-card" id="section-seed">
        <section class="section">
            <h2 class="section-title">üß∞ Seed Data</h2>
            <form action="/seed-data" method="post">
                <label>Departments: <input type="number" name="n_departments" value="5"></label><br><br>
                <label>Employees: <input type="number" name="n_employees" value="50"></label><br><br>
                <button type="submit">Seed Database</button>
            </form>
        </section>
    </div>

    <!-- ORM Query Section -->
    <div class="section-card" id="section-query">
        <section class="section">
            <h2 class="section-title">üß† Run ORM Query</h2>
            <form action="/run-query" method="post">
                <textarea name="query" rows="3" placeholder="Example: db.query(Employee).filter(Employee.age > 30).all()"></textarea><br>
                <button type="submit">Run Query</button>
                <button formaction="/clear-results" formmethod="post">Clear All Results</button>
                <a href="/download-results">üì• Download JSON</a>
            </form>
            {% if results and results|length > 0 %}
                {% set latest = results[-1] %}
                <div class="result-card">
                    <div class="result-header">
                        <div><strong>Executed Query:</strong> <code>{{ latest.query }}</code></div>
                        {% if latest.error %}
                            <span class="error">‚ùå {{ latest.error }}</span>
                        {% else %}
                            <span class="success">‚úÖ Success</span>
                        {% endif %}
                    </div>
                    {% if latest.result %}
                    <div class="result-body">
                        <table>
                            <thead>
                                {% set first_row = latest.result[0] if latest.result else None %}
                                {% if first_row %}
                                <tr>
                                    {% for key in first_row.keys() %}
                                    <th>{{ key }}</th>
                                    {% endfor %}
                                </tr>
                                {% endif %}
                            </thead>
                            <tbody>
                                {% for row in latest.result %}
                                <tr onclick="highlightRow('emp-{{ row.id if 'id' in row else '' }}')">
                                    {% for val in row.values() %}
                                    <td>{{ val if val is not none else '' }}</td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                        <p class="no-results">No data returned.</p>
                    {% endif %}
                </div>
            {% endif %}
        </section>
    </div>

    <!-- Stored Queries Section -->
    <div class="section-card" id="section-stored">
        <section class="section">
            <h2 class="section-title">üíæ Stored Queries</h2>
            {% if stored_queries %}
            <div class="query-circles" id="query-circles">
                {% for q in stored_queries %}
                <div class="circle" data-id="query-{{ q.id }}">{{ loop.index }}</div>
                {% endfor %}
            </div>

            <form action="/update-queries" method="post">
                <div class="query-details" id="query-details">
                    {% for q in stored_queries %}
                    <div class="query-card" id="query-{{ q.id }}">
                        <label><strong>Query {{ loop.index }}:</strong></label>
                        <textarea id="query_text_{{ q.id }}" name="query_{{ q.id }}">{{ q.query }}</textarea><br>
                        <button type="button" onclick="runStoredQuery({{ q.id }})">‚ñ∂ Run</button>
                        <button type="submit" formaction="/update-queries" formmethod="post">üíæ Save Changes</button>
                        <button type="submit" formaction="/delete-query/{{ q.id }}" formmethod="post" onclick="return confirm('Delete this query?')">üóë Delete</button>

                        {% if q.result %}
                        <div class="result-body" id="result-{{ q.id }}">
                            <table>
                                <thead>
                                    <tr>
                                        {% for key in q.result[0].keys() %}
                                        <th>{{ key }}</th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in q.result %}
                                    <tr>
                                        {% for val in row.values() %}
                                        <td>{{ val }}</td>
                                        {% endfor %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="result-body" id="result-{{ q.id }}" style="display:none;"></div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </form>
            {% else %}
            <p>No stored queries found.</p>
            {% endif %}

           {% if results and results|length > 0 %}
                {% set latest = results[-1] %}
                <div class="result-card">
                    <div class="result-header">
                        <div><strong>Executed Query:</strong> <code>{{ latest.query }}</code></div>
                        {% if latest.error %}
                            <span class="error">‚ùå {{ latest.error }}</span>
                        {% else %}
                            <span class="success">‚úÖ Success</span>
                        {% endif %}
                    </div>
                    {% if latest.result %}
                    <div class="result-body">
                        <table>
                            <thead>
                                {% set first_row = latest.result[0] if latest.result else None %}
                                {% if first_row %}
                                <tr>
                                    {% for key in first_row.keys() %}
                                    <th>{{ key }}</th>
                                    {% endfor %}
                                </tr>
                                {% endif %}
                            </thead>
                            <tbody>
                                {% for row in latest.result %}
                                <tr onclick="highlightRow('emp-{{ row.id if 'id' in row else '' }}')">
                                    {% for val in row.values() %}
                                    <td>{{ val if val is not none else '' }}</td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                        <p class="no-results">No data returned.</p>
                    {% endif %}
                </div>
            {% endif %}
          

        </section>
    </div>
</main>
</body>
</html>

